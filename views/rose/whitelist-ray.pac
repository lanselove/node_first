/**
 * modified from https://raw.githubusercontent.com/neko-dev/gfw_whitelist/master/gfw_whitelist.txt
 * ",And pictures in our eyes to get
         Was all our propagation.",
              â€” The Ecstasy BY JOHN DONNE (https://www.poetryfoundation.org/poems/44099/the-ecstasy)
 */

var proxy = 'SOCKS5 127.0.0.1:2801';
var rules = [
    [
        [
            "com.cn",
            "edu.cn",
            "microsoft.com",
            "demdex.net",
            "gfx.ms",
            "msauth.net",
            "akamaized.net",
            "live.com",
            "optimizely.com",
            "msecnd.net",
            "office.com",
            "office365.com",
            "sohucs.com",
            "gifshow.com",
            "ksurl.cn",
            "kuaishou.com",
            "71edge.com",
            "tbcache.com",
            "qy.net",
            "4paradigm.com",
            "pingxx.com",
            "sobot.com",
            "3001.net",
            "gitee.io",
            "badgesize.io",
            "shields.io",
            "rapidvideo.com",
            "bitporno.com",
            "xfantasy.tv",
            "opjav.com",
            "tianyancha.com",
            "jindidata.com",
            "zhuanxiandai.com",
            "vzuu.com",
            "runsheng.com",
            "larsonlimited.com",
            "fm3838.com",
            "zoomyou.cn",
            "zoom3g.com",
            "localhost"
        ],
        [
            "genius.com"
        ]
    ],
    [
        [
            "10010.com",
            "10086.cn",
            "114la.com",
            "115.com",
            "126.com",
            "126.net",
            "127.net",
            "163.com",
            "163yun.com",
            "1688.com",
            "17173.com",
            "178.com",
            "17ce.com",
            "17k.com",
            "189.cn",
            "1qimg.com",
            "1qmsg.com",
            "1tpic.com",
            "1year.cc",
            "1years.cc",
            "2345.com",
            "2cto.com",
            "3366.com",
            "33ss.tech",
            "360.cn",
            "360.com",
            "360buy.com",
            "360buyimg.com",
            "360doc.com",
            "360jie.com",
            "360kan.com",
            "360taojin.com",
            "360top.com",
            "36kr.com",
            "39.net",
            "3dmgame.com",
            "4399.com",
            "51.la",
            "51cto.com",
            "51job.com",
            "52pojie.cn",
            "56.com",
            "58.com",
            "58pic.com",
            "6.cn",
            "7k7k.com",
            "7to.cn",
            "86ps.com",
            "91.com",
            "acfun.cn",
            "acfun.tv",
            "acg.tv",
            "acgvideo.com",
            "acs.org",
            "aday01.com",
            "adf.ly",
            "aicheren.com",
            "aipai.com",
            "airbnb.cn",
            "aiwebcom.com",
            "aixifan.com",
            "aizhan.com",
            "akamaihd.net",
            "akarin.me",
            "akarin.top",
            "alibaba.com",
            "alibaba-inc.com",
            "alibabagroup.com",
            "alibabacorp.com",
            "alibabaplanet.com",
            "alibabadns.com",
            "alicdn.com",
            "aliimg.com",
            "alipay.com",
            "alipayobjects.com",
            "alisports.com",
            "aliyun.com",
            "aliyuncs.com",
            "amap.com",
            "amazon.cn",
            "anjuke.com",
            "anquan.org",
            "anzhi.com",
            "appgame.com",
            "appinn.com",
            "aps.org",
            "areyoucereal.com",
            "arubanetworks.com",
            "atomicstryker.net",
            "augix.me",
            "autohome.com.cn",
            "b23.tv",
            "baidu.com",
            "baiducontent.com",
            "baidupan.com",
            "baidupcs.com",
            "baidustatic.com",
            "bankcomm.com",
            "baozoumanhua.com",
            "battlenet.com.cn",
            "bdimg.com",
            "bdstatic.com",
            "behe.com",
            "beianbeian.com",
            "biliapi.com",
            "biliapi.net",
            "bilibili.com",
            "bilibiligame.net",
            "biligame.com",
            "biligame.net",
            "bing.com",
            "blackyau.cc",
            "blizzard.cn",
            "blizzardgames.cn",
            "blackdragon.com",
            "blogjava.net",
            "boc.cn",
            "bootcdn.cn",
            "bootcss.com",
            "bqtalk.com",
            "bt0.com",
            "bumimi.com",
            "buu.edu.cn",
            "bybbs.org",
            "cachemoment.com",
            "cas.cn",
            "cctv.com",
            "cdn.jsdelivr.net",
            "cdnbee.com",
            "cdndm.com",
            "cdndm5.com",
            "cdnst.net",
            "cdog.me",
            "ce.cn",
            "ceair.com",
            "cee.network",
            "china.com",
            "chinassl.net",
            "chinaunix.net",
            "chinaz.com",
            "chiphell.com",
            "chsi.com.cn",
            "chuangzaoshi.com",
            "cibntv.net",
            "cli.im",
            "cloudinary.com",
            "cloudxns.net",
            "cnbeta.com",
            "cnblogs.com",
            "cnki.net",
            "cnr.cn",
            "cntv.cn",
            "cnzz.com",
            "cnzz.net",
            "coderstory.cn",
            "coding.io",
            "coding.me",
            "coding.net",
            "coolapk.com",
            "coolpad.com",
            "csair.com",
            "csdn.net",
            "csdnimg.cn",
            "css.net",
            "css.network",
            "ct10000.com",
            "ctrip.com",
            "d7vg.com",
            "dandanplay.com",
            "dao123.com",
            "daocloud.io",
            "datagrand.com",
            "ddos.cc",
            "deepin.com",
            "deepin.org",
            "dianping.com",
            "dict.cn",
            "dilidili.com",
            "dilidili.wang",
            "dingtalk.com",
            "diybeta.com",
            "diyvm.com",
            "dm5.com",
            "dmzj.com",
            "dnspod.cn",
            "docin.com",
            "douban.com",
            "douban.fm",
            "doubanio.com",
            "doubleclick.net",
            "douyu.com",
            "douyucdn.cn",
            "doyoo.net",
            "duanwenxue.com",
            "duguletian.com",
            "duoshuo.com",
            "duowan.com",
            "dwstatic.com",
            "dygod.net",
            "eastmoney.com",
            "eeboard.com",
            "elemecdn.com",
            "elong.com",
            "elsevier.com",
            "enkj.com",
            "eqoe.cn",
            "etao.com",
            "eudic.net",
            "fang.com",
            "feng.com",
            "fengkongcloud.com",
            "fengniao.com",
            "fir.im",
            "fliggy.com",
            "flow.ci",
            "freebuf.com",
            "gamersky.com",
            "ganji.com",
            "gank.io",
            "geetest.com",
            "getfedora.org",
            "getui.com",
            "gfan.com",
            "gfan.com",
            "gitee.com",
            "gmw.cn",
            "golaravel.com",
            "gtimg.cn",
            "gtimg.com",
            "gtimg.com.cn",
            "guancha.cn",
            "guokr.com",
            "h-ui.net",
            "h2os.com",
            "hacpai.com",
            "halyul.cc",
            "hao123.com",
            "hdslb.com",
            "hdslb.net",
            "hejie.me",
            "heweather.com",
            "hexun.com",
            "hexunimg.com",
            "hikvision.com",
            "hitokoto.cn",
            "hiwifi.com",
            "hommk.com",
            "hostker.com",
            "huaban.com",
            "huanmusic.com",
            "huanqiu.com",
            "huawei.com",
            "huaweicloud.com",
            "huiji.wiki",
            "huijistatic.com",
            "huijiwiki.com",
            "hujiang.com",
            "huomao.com",
            "hupu.com",
            "huxiu.com",
            "hxjyb.com",
            "hy233.tv",
            "i-meto.com",
            "i21st.cn",
            "i360mall.com",
            "iapps.im",
            "iaweg.com",
            "ibruce.info",
            "iciba.com",
            "ieee.org",
            "ifanr.com",
            "ifanr.in",
            "ifdream.net",
            "ifeng.com",
            "ifengimg.com",
            "iguxuan.com",
            "ijinshan.com",
            "iknoworld.net",
            "im9.com",
            "imqq.com",
            "imiku.me",
            "imjad.cn",
            "imooc.com",
            "imququ.com",
            "indienova.com",
            "installbi.me",
            "ip-api.com",
            "ipip.net",
            "iplaysoft.com",
            "iqing.in",
            "iqiyi.com",
            "iqiyipic.com",
            "irs01.com",
            "it168.com",
            "itc.cn",
            "itellyou.cn",
            "iteye.com",
            "ithome.com",
            "j.cn",
            "jandan.net",
            "javaeye.com",
            "jb51.net",
            "jcloud-cdn.com",
            "jcloud-live.com",
            "jcloud-oss.com",
            "jcloud.com",
            "jclouddn.com",
            "jcloudec.com",
            "jcloudlb.com",
            "jcloudlive.com",
            "jcloudlv.com",
            "jcloudoss.com",
            "jcloudss.com",
            "jcloudstatic.com",
            "jcloudvideo.com",
            "jclps.com",
            "jcodecraeer.com",
            "jd-app.com",
            "jd-ex.com",
            "jd.cn",
            "jd.com",
            "jdcache.com",
            "jdcloud.com",
            "jddapeigou.com",
            "joybuy.com",
            "jfrft.com",
            "jhdec.com",
            "jianguoyun.com",
            "jianshu.com",
            "jianshu.io",
            "jiathis.com",
            "jiemian.com",
            "jikexueyuan.com",
            "jinshuju.net",
            "jisuanke.com",
            "jomodns.com",
            "joyyang.com",
            "kafan.cn",
            "kan300.com",
            "kancloud.cn",
            "kankan.com",
            "kekenet.com",
            "kf5.com",
            "kingsoft.com",
            "kmf.com",
            "knownsec.com",
            "krspace.cn",
            "ksyun.com",
            "ku6.com",
            "kuaizhan.com",
            "lackar.com",
            "lany.me",
            "lanyus.com",
            "lanzous.com",
            "laravel-china.org",
            "lbesec.com",
            "le.com",
            "leancloud.cn",
            "lenovo.com.cn",
            "lenovomobile.cn",
            "lenovomobile.com",
            "letv.com",
            "letvimg.com",
            "liaoxuefeng.com",
            "liepin.com",
            "linuxidc.com",
            "liyin.date",
            "lizhi.io",
            "lncld.net",
            "locvps.com",
            "lofter.com",
            "loj.ac",
            "lolinet.com",
            "longzhu.com",
            "lucifr.com",
            "luogu.org",
            "luojuly.cn",
            "luoo.net",
            "lwl12.com",
            "lyjsws.com",
            "mail4geek.com",
            "manmanbuy.com",
            "maoyan.com",
            "masadora.net",
            "materializecss.cn",
            "maxfox.me",
            "mayshijia.com",
            "mcbbs.net",
            "mdui.org",
            "mediav.com",
            "meiqia.com",
            "meituan.com",
            "meituan.net",
            "meizu.com",
            "mengniang.org",
            "mi.com",
            "mi-img.com",
            "miaopai.com",
            "mifile.cn",
            "mikanani.me",
            "mindstore.io",
            "mingdao.com",
            "minitiao.com",
            "miui.com",
            "mmstat.com",
            "mmtrix.com",
            "moe.im",
            "moe123.net",
            "moegirl.org",
            "moetransit.com",
            "mokeedev.com",
            "momentcdn.com",
            "msftconnecttest.com",
            "mtyun.com",
            "muchong.com",
            "mukewang.com",
            "mumayi.com",
            "muscache.cn",
            "muscache.com",
            "mxhichina.com",
            "myapp.com",
            "mydrivers.com",
            "myqcloud.com",
            "nature.com",
            "nekonazo.com",
            "netease.com",
            "netease.im",
            "netseer.com",
            "newsmth.net",
            "nicaifu.com",
            "nga.cn",
            "ngacn.cc",
            "nuomi.com",
            "nvidia.cn",
            "obsapp.com",
            "oekaki.so",
            "omico.me",
            "oneplus.cn",
            "oneplusbbs.com",
            "onlinedown.net",
            "open-open.com",
            "ops.moe",
            "oray.com",
            "oschina.io",
            "oschina.net",
            "ourdvsss.com",
            "overwatchleague.cn",
            "paidaojia.cn",
            "paipai.com",
            "panda.tv",
            "pcbeta.com",
            "pdcicons.ml",
            "pdim.gs",
            "pengyou.com",
            "phonegap100.com",
            "phpcomposer.com",
            "pingwest.com",
            "playubuntu.cn",
            "plu.cn",
            "pptv.com",
            "prestodb-china.com",
            "psnine.com",
            "pythonclub.org",
            "qbox.me",
            "qcloud.com",
            "qcloudimg.com",
            "qcwgg.com",
            "qdaily.com",
            "qdan.me",
            "qeeyou.com",
            "qhimg.com",
            "qhmsg.com",
            "qhres.com",
            "qianxun.com",
            "qidian.com",
            "qihoo.com",
            "qihucdn.com",
            "qingmang.me",
            "qingting.fm",
            "qiniu.com",
            "qiniucdn.com",
            "qiyi.com",
            "qiyipic.com",
            "qiyukf.com",
            "qlogo.cn",
            "qnssl.com",
            "qpic.cn",
            "qq.com",
            "qqmail.com",
            "qqzzz.net",
            "qunar.com",
            "qzone.com",
            "renren.com",
            "researchgate.net",
            "right.com.cn",
            "rkecloud.com",
            "rkidc.net",
            "rlcdn.com",
            "rom.cn",
            "rom.mk",
            "rongcloud.cn",
            "rrfmn.com",
            "rrimg.com",
            "rsc.org",
            "ruanyifeng.com",
            "ruby-china.org",
            "runoob.com",
            "sandai.net",
            "sarm.net",
            "sb.sb",
            "sciencedirect.com",
            "sciencemag.org",
            "sciencenet.cn",
            "sdo.com",
            "seele.tech",
            "segmentfault.com",
            "sekorm.com",
            "sensorsdata.cn",
            "servicewechat.com",
            "sf-express.com",
            "shikezhi.com",
            "shimo.im",
            "shiyanlou.com",
            "sigmaaldrich.com",
            "sina.cn",
            "sina.com",
            "sina.com.cn",
            "sinaapp.com",
            "sinaedge.com",
            "sinaimg.cn",
            "sinaimg.com",
            "sinajs.cn",
            "since1989.org",
            "sm.cn",
            "sm.ms",
            "smart2pay.com",
            "smartgslb.com",
            "smartisan.com",
            "smtcdns.com",
            "smzdm.com",
            "so.com",
            "sogou.com",
            "sohu.com",
            "soku.com",
            "songshuhui.net",
            "soso.com",
            "soufun.com",
            "speedtest.net",
            "springer.com",
            "springerlink.com",
            "sspai.com",
            "stargame.com",
            "steamcn.com",
            "steamdb.info",
            "steampowered.com",
            "suning.com",
            "swapteam.cn",
            "sznews.com",
            "t.tt",
            "tanx.com",
            "taobao.com",
            "taobao.org",
            "taobaocdn.com",
            "tapdb.net",
            "tapimg.com",
            "taptap.com",
            "tbcdn.cn",
            "tencent.com",
            "tencent.com.cn",
            "tencentmind.com",
            "tenpay.com",
            "tenxcloud.com",
            "tgbus.com",
            "thepaper.cn",
            "thinkphp.cn",
            "thomsonreuters.com",
            "tianya.cn",
            "tiebaimg.com",
            "tietuku.com",
            "tigerlust.com",
            "tingyun.com",
            "tmall.com",
            "tmalltv.com",
            "tool.lu",
            "toplife.com",
            "totolink.cn",
            "toushibao.com",
            "toutiao.com",
            "toutiao.io",
            "tower.im",
            "tplogin.cn",
            "truevue.org",
            "ttt.tt",
            "tudou.com",
            "tuicool.com",
            "tuna.moe",
            "tuniu.com",
            "u9u9.com",
            "ubisoft.com.cn",
            "ubuntu.org.cn",
            "uisdc.com",
            "umeng.com",
            "upaiyun.com",
            "upyun.com",
            "ustc.edu.cn",
            "ustclug.org",
            "uuu.moe",
            "uxengine.net",
            "v2ex.com",
            "vamaker.com",
            "vg.com",
            "vhall.com",
            "videojj.com",
            "viosey.com",
            "vip.com",
            "vmall.com",
            "voidcn.com",
            "vpgame.com",
            "vpgcdn.com",
            "vpsmm.com",
            "vss.im",
            "vuejs.org.cn",
            "w3school.com.cn",
            "waerfa.com",
            "wandoujia.com",
            "wanmei.com",
            "wdfok.com",
            "webofknowledge.com",
            "wechat.com",
            "wegame.com",
            "weibo.com",
            "weibo.com.cn",
            "weidunewtab.com",
            "weiosx.com",
            "weiyun.com",
            "wht.im",
            "wiley.com",
            "wisenjoy.com",
            "wiz.cn",
            "wodemo.com",
            "woyoo.com",
            "xcar.com.cn",
            "xclient.info",
            "xf9168.com",
            "xiachufang.com",
            "xiami.com",
            "xiami.fm",
            "xiami.net",
            "xiaomi.cn",
            "xiaomi.com",
            "xiaomi.net",
            "xiaomiyoupin.com",
            "xinhuanet.com",
            "xitu.io",
            "xldns.net",
            "xnimg.cn",
            "xnpic.com",
            "xs8.cn",
            "xuanfengge.com",
            "xuetangx.com",
            "xujc.com",
            "xunlei.com",
            "xunyou.com",
            "xx1t.com",
            "xxsy.net",
            "xycdn.com",
            "yamibo.com",
            "yaohuo.me",
            "ydstatic.com",
            "yecdn.com",
            "yesky.com",
            "yiche.com",
            "yinxiang.com",
            "ykimg.com",
            "ylmf.net",
            "ynzs.cn",
            "youdao.com",
            "youku.com",
            "youth.cn",
            "yunpian.com",
            "yunshipei.com",
            "yy.com",
            "zaih.com",
            "zcool.com.cn",
            "zhan.com",
            "zhangyao.name",
            "zhanqi.tv",
            "zhaojin97.cn",
            "zhaopin.com",
            "zhihu.com",
            "zhimg.com",
            "zhiziyun.com",
            "zhujike.com",
            "zimuzu.tv",
            "znyj365.com",
            "zol.com.cn",
            "zuk.cn"
        ],
        []
    ]
];

/*
var subnetIpRangeList = [
0,1,
167772160,184549376,    //10.0.0.0/8
2886729728,2887778304,  //172.16.0.0/12
3232235520,3232301056,  //192.168.0.0/16
2130706432,2130706688   //127.0.0.0/24
];
function convertAddress(ipchars) {
    var bytes = ipchars.split('.');
    var result = (bytes[0] << 24) |
    (bytes[1] << 16) |
    (bytes[2] << 8) |
    (bytes[3]);
    return result >>> 0;
}
function check_ipv4(host) {
    var re_ipv4 = /^\d+\.\d+\.\d+\.\d+$/g;
    if (re_ipv4.test(host)) {
        return true;
    }
}
function isInSubnetRange(ipRange, intIp) {
    for ( var i = 0; i < 10; i += 2 ) {
        if ( ipRange[i] <= intIp && intIp < ipRange[i+1] )
            return true;
    }
}
function getProxyFromIP(strIp) {
    var intIp = convertAddress(strIp);
    if ( isInSubnetRange(subnetIpRangeList, intIp) ) {
        return 'DIRECT';
    }
    return proxy;
}

    if ( check_ipv4(host) === true ) {
        return getProxyFromIP(host);
    }
*/

function FindProxyForURL(url, host) {
    for (var i = 0; i < rules.length; i++) {
        var ret = testHost(host, i);
        if (ret != undefined)
            return ret;
    }
    return proxy;
}

function testHost(host, index) {
    for (var i = 0; i < rules[index].length; i++) {
        for (var j = 0; j < rules[index][i].length; j++) {
            var lastRule = rules[index][i][j];
            if (host == lastRule || host.endsWith('.' + lastRule))
                return i % 2 == 0 ? 'DIRECT' : proxy;
        }
    }
}

// REF: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/endsWith
if (!String.prototype.endsWith) {
    String.prototype.endsWith = function(searchString, position) {
        var subjectString = this.toString();
        if (typeof position !== 'number' || !isFinite(position) || Math.floor(position) !== position || position > subjectString.length) {
            position = subjectString.length;
        }
        position -= searchString.length;
        var lastIndex = subjectString.indexOf(searchString, position);
        return lastIndex !== -1 && lastIndex === position;
  };
}
